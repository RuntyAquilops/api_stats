# Сервис для счетчиков статистики
Данный сервис представляет собой набор методов в виде HTTP-хендлеров с возвращаемым ответом в формате json. 
* Язык программирования: PHP
* База данных: mySQL
* Веб-сервер: Apache

# Инструкция для запуска
1. Склонируйте репозиторий
```
git clone https://github.com/RuntyAquilops/api_stats.git
```
2. Для сборки контейнеров используйте следующую команду
```
docker-compose up --build -d
```
Phpmyadmin: http://localhost:8000

Apache: http://localhost

Чтобы запустить bash в контейнере, нужно выполнить данную команду:
```
docker exec -it php bash
```
# Примеры api методов
## Метод сохранения статистики
Принимает на вход:

* date - дата события
* views - количество показов
* clicks - количество кликов
* cost - стоимость кликов (в рублях с точностью до копеек)
Поля views, clicks и cost - опциональные.

Возвращает http code 200 в случае успеха и код ошибки в других случаях.
Запрос:
```
curl -d "date=2021-12-12" http://localhost/stats
```
## Метод показа статистики
Принимает на вход:
* from - дата начала периода (включительно)
* to - дата окончания периода (включительно)

Возвращаемые значения:
* id_event - id события
* date - дата события
* views - количество показов
* clicks - количество кликов
* cost - стоимость кликов
* cpc = cost/clicks (средняя стоимость клика)
* cpm = cost/views * 1000 (средняя стоимость 1000 показов)

```
curl "http://localhost/stats?from=2021-01-01&to=2021-12-12"
```
Возвращаемую статистику можно отсортировать по любому полю. Если написан '-' перед параметром, то значения сортируются по убыванию (DESC). Если ничего не указано, то сортировка по возрастанию (ASC).
```
curl "http://localhost/stats?from=2021-01-01&to=2021-12-12&sort=-views"
```
## Метод сброса статистики
Удаляет всю сохраненную статистику. Возвращает http code 200, если статистика удалена и код ошибки, если запрос не был выполнен.

```
curl -X DELETE http://localhost/stats
```
# Контакты
Телеграмм: https://t.me/RuntyAquilops

Почта: kate24kay@gmail.com
